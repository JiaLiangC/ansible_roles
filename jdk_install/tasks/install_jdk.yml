---
- name: get jdk packet dir name
  local_action: shell tar tvf {{jdk_packet}} |tail -n 1 |awk '{print $NF}' |awk -F'/' '{print $1}'
  register: jdk_dir_name
  run_once: true

- name: ensure install dir present
  file: path={{jdk_install_dir}} state=directory owner=root group=root mode=0755
- name: install jdk
  unarchive: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} creates={{ item.creates }}
  with_items:
    - {src: '{{ jdk_packet }}', dest: '{{jdk_install_dir}}/', owner: root, group: root, creates: '{{jdk_install_dir}}/{{jdk_dir_name.stdout}}'}

- name: create jdk link file
  file: src={{ item.src }} dest={{item.dest}} owner=root group=root mode={{item.mode}} state=link
  with_items:
    - { src: '{{jdk_install_dir}}/{{jdk_dir_name.stdout}}', dest: '{{jdk_base_dir}}', mode: "0755", state: link}
