---
- name: copy filebeat.ini file
  template: 
    src: '{{ filebeat_src_boot_conf }}' 
    dest: '{{ supervisor_conf_dir }}' 
    owner: 'root' 
    group: 'root' 
    mode: "0644"
    backup: yes
  register: ini_result

#- name: test result
#  shell: echo "{{ini_result}}" > /tmp/test_result
- name: supervisor update
  shell: supervisorctl update
  when: ini_result.results.failed == False and ini_result.changed == True
  ignore_errors: true

- name: start filebeat
  supervisorctl: 
    name: '{{ filebeat_app_name }}'
    state: started
