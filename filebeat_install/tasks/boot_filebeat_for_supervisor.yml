---
- name: copy filebeat.ini file
  template: 
    src: '{{ item.src }}' 
    dest: '{{ item.dest }}' 
    owner: '{{ item.owner }}' 
    group: '{{ item.group }}' 
    mode: '{{ item.mode }}'
    backup: yes
  with_items:
    - { src: '{{filebeat_src_boot_conf}}', dest: '{{ supervisor_conf_dir }}/', owner: root, group: root, mode: "0644"}
  register: ini_result

#- name: test result
#  shell: echo "{{ini_result}}" > /tmp/test_result
- name: supervisor update
  shell: supervisorctl update
  when: ini_result.results[0].failed == False and ini_result.changed == True
  ignore_errors: true

- name: start filebeat
  supervisorctl: name={{ item }} state=started
  with_items:
    - "{{filebeat_app_name}}"
