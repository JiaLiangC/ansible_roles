
- name: get filebeat packet dir name
  local_action: shell tar tvf {{filebeat_packet}} |tail -n 1 |awk '{print $NF}' |awk -F'/' '{print $1}'
  register: filebeat_dir_name
  run_once: true

- name: cp and unarchive filebeat to remote host
  unarchive: src={{ item.src }} dest={{ item.dest }} owner=root group=root creates={{ item.creates }}
  with_items:
    - { src: '{{filebeat_packet}}', dest: '{{filebeat_install_dir}}/', creates: '{{ filebeat_install_dir }}/{{filebeat_dir_name.stdout}}', mode: "0755" }

- name: create filebeat link file
  file: src={{ item.src }} dest={{item.dest}} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} state={{ item.state }}
  with_items:
    - { src: '{{filebeat_install_dir }}/{{filebeat_dir_name.stdout}}', dest: '{{filebeat_base_dir}}', owner: root, group: root, mode: "0777", state: link}
