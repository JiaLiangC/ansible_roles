# edirtor: haifeng
# 2017/01/10

- name: install dependece packet
  yum: name={{ item }} state=latest
  with_items:
    - epel-release
- name: install nginx packet
  yum: name={{ item }} state=latest
  with_items:
    - nginx
- name: copy conf file
  template: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }}
  with_items:
    - {src: 'nginx.conf', dest: '/etc/nginx/' , owner: 'root', group: 'root', mode: '0644'}
    - {src: 'nginx.logrotate', dest: '/etc/logrotate.d/nginx' , owner: 'root', group: 'root', mode: '0644'}
    - {src: 'htpasswd', dest: '/etc/nginx/' , owner: 'root', group: 'root', mode: '0644'}
  tags:
    - modify_nginx_conf
  notify:
    - restart nginx service 
#- name: copy conf file
#  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }}
#  with_items:
#    - { src: 'nginx.conf', dest: /etc/nginx/, owner: root, group: root, mode: '0644'}
#  tags:
#    - modify_nginx_conf
#  notify:
#    - restart nginx service
- name: set nginx boot on starting up
  service: name={{ item.name }} state={{ item.state }} enabled=yes
  with_items:
    - { name: nginx, state: started }

- include: core_argument.yml
