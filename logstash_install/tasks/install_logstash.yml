
- name: get logstash packet dir name
  local_action: shell tar tvf {{logstash_packet}} |tail -n 1 |awk '{print $NF}' |awk -F'/' '{print $1}'
  register: logstash_dir_name
  when: logstash_packet is not none and logstash_packet is exists
  run_once: true

- name: cp and unarchive logstash to remote host
  unarchive: 
    src: "{{ item.src }}" 
    dest: "{{ item.dest }}" 
    owner: '{{ logstash_run_user }}' 
    group: "{{ logstash_run_user }}" 
    creates: "{{ item.creates }}"
  with_items:
    - { src: '{{logstash_packet}}', dest: '{{logstash_install_dir}}/', creates: '{{ logstash_install_dir }}/{{logstash_dir_name}}', mode: '0755' }
  register: logstash_install_result

- name: create logstash link file
  file: 
    src: "{{ item.src }}" 
    dest: "{{item.dest}}" 
    owner: root
    group: root
    mode: "{{ item.mode }}" 
    state: "{{ item.state }}"
  with_items:
    - { src: '{{logstash_install_dir }}/{{logstash_dir_name.stdout}}', dest: '{{logstash_base_dir}}', mode: "0777", state: link}
