#- name: generate redis pass
#  shell: echo "{{ansible_default_ipv4.macaddress}}{{redis_port}}" | base64 | tr -dc A-Za-z0-9 | tail -c 15
#  register: redis_pass
- name: copy redis conf file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }}
  with_items:
    - { src: "redis.logrotate", dest: '/etc/logrotate.d/redis_for_ansible',owner: root, group: root, mode: "0644"}
  when: redis_run_method == "system"

- name: copy redis conf file
  template: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: "{{redis_src_conf}}", dest: '{{ redis_conf_dir}}/{{redis_service_name}}.conf',owner: '{{redis_run_user}}', group: '{{redis_run_user}}', mode: "0644"}
    - { src: "redis.sh", dest: '/etc/profile.d/redis.sh',owner: root, group: root, mode: "0644"}
  tags:
   - modify_redis_conf
  notify:
   - restart redis service for supervisor
