- name: modify about redis core args
  sysctl: name={{ item.name }} value={{ item.value }} reload=no state=present ignoreerrors=yes
  with_items:
    - { name: 'net.ipv4.tcp_timestamps', value: 1}
    - { name: 'net.ipv4.tcp_tw_recycle', value: 0}
    - { name: 'net.core.somaxconn', value: 65535}
    - { name: 'vm.swappiness', value: 0}
    - { name: 'vm.overcommit_memory', value: 1}
- name: close transparent_hugepage
  shell: "echo never > /sys/kernel/mm/transparent_hugepage/enabled"
- name: write close trhansparent_hugepage into rc.local
  lineinfile: dest={{item.dest}} regexp={{ item.regexp }} line={{ item.line }} backrefs=no
  with_items:
    - { dest: /etc/rc.d/rc.local, regexp: "echo never > /sys/kernel/mm/transparent_hugepage/enabled", line: "echo never > /sys/kernel/mm/transparent_hugepage/enabled" }
