---
- name: copy logstash boot file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: 'logstash_rcs2.ini', dest: '{{supervisor_conf_dir}}/logstash_rcs2.ini', owner: root, group: root, mode: '0644' }
  notify:
    - supervisor update
  ignore_errors: true

- name: copy logstash_rcs2-abevent-worker-info conf file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: 'logstash_rcs2-abevent-worker-info.conf', dest: '{{logstash_conf_dir}}/', owner: root, group: root, mode: '0644' }
  notify:
    - restart logstash_rcs2-abevent-worker-info

- name: copy logstash_rcs2-api-worker-info conf file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: 'logstash_rcs2-api-worker-info.conf', dest: '{{logstash_conf_dir}}/', owner: root, group: root, mode: '0644' }
  notify:
    - restart logstash_rcs2-api-worker-info
- name: copy logstash_rcs2-jobcli-info conf file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: 'logstash_rcs2-jobcli-info.conf', dest: '{{logstash_conf_dir}}/', owner: root, group: root, mode: '0644' }
  notify:
    - restart logstash_rcs2-jobcli-info
- name: copy logstash_rcs2-scheduler-info conf file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: 'logstash_rcs2-scheduler-info.conf', dest: '{{logstash_conf_dir}}/', owner: root, group: root, mode: '0644' }
  notify:
    - restart logstash_rcs2-scheduler-info

- name: copy logstash_rcs2-server-info conf file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: 'logstash_rcs2-server-info.conf', dest: '{{logstash_conf_dir}}/', owner: root, group: root, mode: '0644' }
  notify:
    - restart logstash_rcs2-server-info

- name: start rcs logstash
  supervisorctl: name={{ item }} state=started
  with_items:
    - logstash_rcs2-abevent-worker-info
    - logstash_rcs2-api-worker-info
    - logstash_rcs2-jobcli-info
    - logstash_rcs2-scheduler-info
    - logstash_rcs2-server-info
