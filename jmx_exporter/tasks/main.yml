# edirtor: haifeng
# 2017/03/28

- name: create jmx_exporter dir
  file: path={{ item }} owner=root group=root mode=0755 state=directory
  with_items:
    - '{{jmx_exporter_conf_dir}}'
    - '{{jmx_exporter_data_dir}}'
    - '{{jmx_exporter_base_dir}}'
    - '{{jmx_exporter_log_dir}}'

- name: get jmx_exporter jar name
  local_action: shell echo {{jmx_exporter_packet}} |xargs basename
  register: jmx_exporter_jar_name

- name: copy jmx_exporter jar file
  copy: src={{ item.src }} dest={{ item.dest }} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} backup=yes
  with_items:
    - { src: '{{jmx_exporter_packet}}', dest: '{{jmx_exporter_base_dir }}/', owner: root, group: root, mode: "0644"}

- name: create jmx_exporter link file
  file: src='{{jmx_exporter_base_dir}}/{{jmx_exporter_jar_name.stdout}}' dest='{{jmx_exporter_base_dir}}/jmx_exporter.jar' state=link


- name: copy jmx_exporter conf file
  template: src={{ item }} dest={{ jmx_exporter_conf_dir }} owner=root group=root mode=0644 backup=yes
  with_items: "{{jmx_exporter_confs}}"
