- name: get kylin packet dir name
  local_action: shell "tar tvf {{kylin_packet}} |tar tvf - |tail -n 1 |awk '{print $NF}' |awk -F'/' '{print $1}'"
  register: kylin_dir_name
 
- name: cp and unarchive kylin to remote host
  unarchive: src={{ item.src }} dest={{ item.dest }} owner='{{ kylin_run_user }}' group={{ kylin_run_user }} creates={{ item.creates }}
  with_items:
    - { src: '{{kylin_packet}}', dest: '{{kylin_install_dir}}/', creates: '{{ kylin_install_dir }}/{{kylin_dir_name.stdout}}', mode: '0755' }

- name: create kylin link file
  file: src={{ item.src }} dest={{item.dest}} owner={{ item.owner }} group={{ item.group }} mode={{ item.mode }} state={{ item.state }}
  with_itemsn:
    - { src: '{{kylin_install_dir }}/{{kylin_dir_name.stdout}}', dest: '{{kylin_base_dir}}', owner: root, group: root, mode: 0777, state: link}
