# /path/to/src 
# /path/dest/src

- name: project_hosts install rsync
  yum:
    name: rsync
    state: present
  ignore_errors: true

- name: rsync project packet to remote
  synchronize: 
    src: '{{project_source_dir}}/{{project_packet_name}}'
    #dest: '{{project_install_dir}}/{{project_packet_name}}' 
    dest: '{{project_install_dir}}' 
    recursive: true
    rsync_opts:
      - "--owner={{project_run_user}}"
      - "--group={{project_run_group}}"
      - "--chown={{project_run_user}}:{{project_run_group}}"
    #owner: '{{project_run_user}}' 
    #group: '{{project_run_group}}' 
    #mode: "push"
  register: cp_result


- name: chmod project dir
  shell: "{{item}}"
  loop:
    - 'find {{project_install_dir}} -type d -exec chmod 0755 {} \;'
    - 'find {{project_install_dir}} -type f -exec chmod 0644 {} \;'

- name: update project packet link file
  file:
    src: '{{project_install_dir}}'
    #dest: '{{project_install_dir}}/{{project_packet_link_name}}'
    dest: '{{project_packet_link_name}}'
    owner: '{{project_run_user}}'
    group: '{{project_run_group}}'
    state: link
  when: project_packet_link_name is not none and project_packet_link_name != '' and project_install_dir != project_packet_link_name

