
- name: copy project nginx conf file
  #template: src="/data/apps/data/ansible/{{project_name}}/{{prog_name}}.ini" dest="{{super_conf_dir}}" owner="{{user}}" group="{{user}}" mode=0644
  template: 
    src: "{{project_boot_file}}" 
    dest: "{{nginx_conf_dir}}/conf.d/" 
    owner: "{{nginx_run_user}}" 
    group: "{{nginx_run_user}}" 
    mode: "0644"
    backup: yes
  register: copy_nginx_file
  tags:
    - copy_project_nginx_file
  notify:
    - nginx_reload

- name: reload nginx for centos7
  systemd: 
    name: nginx 
    state: reloaded 
  when: ansible_os_family == "RedHat" and ansible_service_mgr == 'systemd' and copy_nginx_file.changed == true

- name: reload nginx for centos6
  service: 
    name: nginx 
    state: reloaded
  when: ansible_os_family == "RedHat" and ansible_service_mgr == 'upstart' and copy_nginx_file.changed == true
