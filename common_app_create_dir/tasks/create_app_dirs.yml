
- name: create base dir
  file: 
    path: '{{app_install_dir}}' 
    state: directory 
    owner: root 
    group: root 
    mode: "0755"
  #loop:
  #  #- "{{app_base_dir}}"
  #  - "{{app_install_dir}}"

- name: create app dir
  file: 
    path: '{{item}}' 
    state: 'directory' 
    owner: '{{app_run_user}}' 
    group: '{{app_run_group}}' 
    mode: "0755"
  loop: '{{app_dirs}}'
    #- "{{app_conf_dir}}"
    #- "{{app_log_dir}}"
    #- "{{app_var_dir}}"
    #- "{{app_data_dir}}"
    #- "{{app_child_conf_dir}}"
  when: 
    - item is not none
    - item != ""
    - item != app_base_dir
    - item | dirname != app_base_dir
  #when: (item is not none or item != "") and item | dirname != app_base_dir

# 创建其他目录的操作，由其他引用的 role 自行创建
#- name: mkdir app other dir
#  file: 
#    path: '{{item}}' 
#    state: directory 
#    owner: '{{app_run_user}}' 
#    group: '{{app_run_group}}' 
#    mode: "0755"
#  with_items: '{{app_other_dirs}}'
#  when: item is not none and item | basename != app_base_dir
  #when: app_other_dirs is defined and item | basename != app_base_dir
